#include "LCD.h"



uint8_t data2[]=
/*--  调入了一幅图像：这是您新建的图像  --*/
/*--  宽度x高度=128x64  --*/
{
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x80,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};

#define cmd 0
#define data 1
#define lcd_delay 1

extern float Vmaxpp;
extern uint32_t AD_ValueS[128];
uint8_t Char_Location[4][8]=
{												
	{0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87},//第一行汉字位置
	{0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97},//第二行汉字位置
	{0x88,0x89,0x8a,0x8b,0x8c,0x8d,0x8e,0x8f},//第三行汉字位置
	{0x98,0x99,0x9a,0x9b,0x9c,0x9d,0x9e,0x9f},//第四行汉字位置
};

void delay(uint16_t time)
{
    while(time--);
}

void lcd_write(uint8_t cd,uint8_t dat)
{
    uint8_t i;
    uint8_t dat_h = dat&0xf0;
    uint8_t dat_l = (dat&0x0f)<<4;
    
    //LCD使能
    CS_ON;  
    
    //开头5个1
    for(i=0;i<5;i++)    

    {
        SDA_ON;
        CLK_ON;
        delay(lcd_delay);
        CLK_OFF;
        delay(lcd_delay);
    }
    
    //写数据
    SDA_OFF;
    CLK_ON;
    delay(lcd_delay);
    CLK_OFF;
    delay(lcd_delay);
    
    
    //数据或者命令
    if(cd ==0)  
    {
        SDA_OFF;
    }
    else
    {
        SDA_ON;
    }
    CLK_ON;
    delay(lcd_delay);
    CLK_OFF;
    delay(lcd_delay);
    
    
    //固定写0
    SDA_OFF;
    CLK_ON;
    delay(lcd_delay);
    CLK_OFF;
    delay(lcd_delay);
    
    //写高位
    for(i=0;i<8;i++)
    {
        if((dat_h&0x80) == 0x80)
        {
            SDA_ON;     
        }
        else
        {
            SDA_OFF;
        }
        CLK_ON;
        delay(lcd_delay);
        CLK_OFF;
        delay(lcd_delay);
        
        
        dat_h<<=1;
    }
    
    //写低位
    for(i=0;i<8;i++)
    {
        if((dat_l&0x80) == 0x80)
        {
            SDA_ON;
        }
        else
        {
            SDA_OFF;
        }
        CLK_ON;
        delay(lcd_delay);
        CLK_OFF;
        delay(lcd_delay);
        
        
        dat_l<<=1;
    }
    
    //LCD失能
    CS_OFF;
    
    delay(1000); 
}

void LCDInit(void)
{
    RST_ON;
    HAL_Delay(10);
    
    
    lcd_write(cmd,0x30);
    lcd_write(cmd,0x08);
    lcd_write(cmd,0x01);
    lcd_write(cmd,0x06);
    lcd_write(cmd,0x0c);  
}


void LCDClear(void)
{
	RST_OFF;
	RST_ON;
	lcd_write(0,0x01);
	delay(10);
}


void LCDAddress(uint8_t x, uint8_t y)
{
	if(x==0)				x=0x80+y;
	else if(x==1)			x=0x90+y;
	else if(x==2)			x=0x88+y;
	else if(x==3)			x=0x98+y;

	lcd_write(0,x);
}

void LCD_display(uint8_t x,uint8_t y,char *a)
{
	if(x>4)		x=0;
	LCDAddress(x, y);
	while(*a>0)
	{
	  lcd_write(1,*a++);
	}
}

void LCD_IMG(uint8_t *img)
{
	uint8_t i,j;
	lcd_write(0,0x34);
	lcd_write(0,0x36);
	for(i=0;i<32;i++)
	{
		lcd_write(0,0x80+i);			//行
		lcd_write(0,0x80);
		for(j=0;j<16;j++)
		{
			lcd_write(1,*img++);
		}
	}
	
	for(i=0;i<32;i++)
	{
		lcd_write(0,0x80+i);
		lcd_write(0,0x88);
		for(j=0;j<16;j++)
		{
			lcd_write(1,*img++);
		}
	}
//	LCDWrite(0,0x36);
	lcd_write(0,0x30);
}



void Clear_Draw()
{
	unsigned char x=0,j,i,y;
	unsigned int tmp0=0;
	lcd_write(0,0x34);
	for(i=0;i<2;i++)						//分两屏，上半屏和下半屏
	{						
		for(y=0;y<32;y++)					 //32行,因此，y地址为0-31
		{					
			lcd_write(0,0x80+y);		//y地址
			lcd_write(0,0x80+x);		//x地址，x地址会自动加1，因此只给出初始地址
			for(j=0;j<16;j++)	
				lcd_write(1,0x00);		//清屏数据写入LCD
			tmp0+=16;		
		}
		x=8;
	}
	lcd_write(0,0x36);			//扩充功能设定
	lcd_write(0,0x30);			//返回基本功能
}




void Set_Reverse(unsigned char y,unsigned char x,unsigned char width)
{
    unsigned char i,j;
	//图像式清屏
    Clear_Draw();
	//开扩展指令
    lcd_write(0,0x34);

	//哪一行
    switch(y)
   {   
       case 0:y=0X80;break;
       case 1:y=0X90;break;
       case 2:y=0X88;break;
       case 3:y=0X98;break;
   }
   
   //每行有16个字节
   for(i=0;i<16;i++)
    {
	//设置水平地址，一行中的第几个
	if (y==0X80||y==0X88)   
	  { lcd_write(0,0X80+i);}
	else
	  { lcd_write(0,0x90+i);}
	
	//具体地址
	lcd_write(0,y+x);
	
	//需要的长度
	for(j=0;j<width;j++)
	{
		lcd_write(1,0XFF);
	}
    }
   lcd_write(0,0x36);
   lcd_write(0,0x30);
}

